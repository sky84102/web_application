<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mahjong</title>
    <style>
    body{
        width: 1600px;
    }
    table{
        border: solid 1px;
        border-collapse: collapse;
    }
    td{
        border: solid 1px;
        text-align: center;
        padding: 10px;
    }
    button{
        font-size: 150%;
    }
    select{
        font-size: 120%;
    }
    input[type=checkbox], input[type=radio] {
        width: 20px;
        height: 20px;
        vertical-align: middle;
        margin: 3px 0;
    }
    </style>
</head>
<body>
    <font color="#F00">九蓮宝燈・国士無双・七対子は非対応/喰いタンあり</font>
    <table id="yaku_list" style="float: right; margin: 10px 20px;"> </table><br><hr>
    <form id="mj">
    <table>
        <tr>
            <td style="background: #DDFFEE">場風<br><select id="wind1"><option value="東">東</option><option value="南" selected>南</option><option value="西">西</option><option value="北">北</option></select></td>
            <td style="background: #DDFFEE">自風<br><select id="wind2"><option value="東">東</option><option value="南" selected>南</option><option value="西">西</option><option value="北">北</option></select></td>
            <td rowspan="2" colspan="2" style="text-align: left;background: #DDFFEE">
                <input type="checkbox" id="reach" onclick="checkReach();"><label for="reach">立直</label><br>
                <input type="checkbox" id="double" onclick="checkReach();"><label for="double">ダブル立直</label><br>
                <input type="checkbox" id="ippatsu" onclick="checkReach();" disabled><label for="ippatsu">一発</label><br>
                <input type="checkbox" id="haitei" onclick="checkReach();"><label for="haitei">海底摸月/河底撈魚</label><br>
                <input type="checkbox" id="rinshang" onclick="checkReach();"><label for="rinshang">嶺上開花</label>
                <input type="checkbox" id="chankan" onclick="checkReach();"><label for="chankan">槍槓</label>
            </td>
            <td rowspan="2" colspan="2" style="text-align: center;background: #DDFFEE">青天井<br>(役満1000万)<br><input type="checkbox" id="aotenjou"></td>
        </tr>
        <tr style="background: #FFDDFF">
            <td style="background: #DDFFEE"><input type="radio" name="tsumoron" id="tsumo" value="tsumo" checked><label for="tsumo">ツモ</label><br><input type="radio" name="tsumoron" id="ron" value="ron"><label for="ron">ロン</label></td>
            <td style="background: #DDFFEE">ドラ<br><input type="number" id="dora" value="0" min="0" max="41" style="width:40px;"></td>
        </tr>
    </table><br>
    <button type="button" onclick="calc();">計算</button>
    <br><br>

    <table>
        <tr style="background: #FFFFDD"><td>手牌</td>
            <td><select id="type1"><option value="m">萬</option><option value="p">筒</option><option value="s">索</option><option value="c" selected>字</option></select><br><input type="text" size="4" id="div1" value="nn"></td>
            <td><select id="type2"><option value="m" selected>萬</option><option value="p">筒</option><option value="s">索</option><option value="c">字</option></select><br><input type="text" size="4" id="div2" value="123"></td>
            <td><select id="type3"><option value="m">萬</option><option value="p" selected>筒</option><option value="s">索</option><option value="c">字</option></select><br><input type="text" size="4" id="div3" value="123"></td>
            <td><select id="type4"><option value="m">萬</option><option value="p">筒</option><option value="s" selected>索</option><option value="c">字</option></select><br><input type="text" size="4" id="div4" value="123"></td>
            <td><select id="type5"><option value="m">萬</option><option value="p" selected>筒</option><option value="s">索</option><option value="c">字</option></select><br><input type="text" size="3" id="div5" value="23"></td>
            <td>和了牌<br><input type="text" size="1" id="div6" value="1"></td>
            <td id="tokuten1">2<sup>（翻数）</sup></td><td></td><td>符</td><td></td><td>点数</td>
        </tr>
        <tr style="background: #FFDDFF">
            <td>状態</td><td><div id="ci1">?</div></td><td><div id="ci2">?</div></td><td><div id="ci3">?</div></td><td><div id="ci4">?</div></td><td colspan="2"><div id="ci5">?</div></td>
            <td id="hansuu">?</td><td>×</td><td id="fusuu">?</td><td id="tokuten2">× 4 =</td><td id="tensuu">?</td>
        </tr>
        <tr style="background: #DDFFFF">
            <td>ポン<br>チー<br>明槓</td>
            <td><input type="checkbox" id="call1"></td>
            <td><input type="checkbox" id="call2" checked></td>
            <td><input type="checkbox" id="call3"></td>
            <td><input type="checkbox" id="call4"><input type="checkbox" id="call5" style="display: none;"></td>
            <td colspan="2"></td>
            <td style="background: #FFDDEE">基本符</td>
            <td style="background: #FFDDEE">ツモ<br>or<br>ロン</td>
            <td style="background: #FFDDEE">待ち</td><td style="background: #FFDDEE">符合計</td>
            <td style="background: #FFDDFF", id="tokuten3"></td>
        </tr>
        <tr style="background: #FFDDEE"><td>符</td><td><div id="fu1">0</div></td><td><div id="fu2">0</div></td><td><div id="fu3">0</div></td><td><div id="fu4">0</div></td><td colspan="2"><div id="fu5">0</div></td><td>20</td><td><div id="fu6">0</div></td><td><div id="fu7">0</div></td><td><div id="fu8">0</div></td></tr>
    </table>
    [東/e, 南/s, 西/w, 北/n, 白/b, 発/f, 中/z]

    </form>
    <br>
    <table id="yaku" style="float: left"><tr><td>役名</td><td>翻数</td></tr></table>
    <!-- <table id="tokuten" style="float: left;margin-left: 30px;border-style: none">
        <tr><td>2<sup>（翻数）</sup></td><td></td><td>符</td><td></td><td></td><td></td><td>点数</td></tr>
        <tr></tr>
    </table> -->



    <script>
        function checkReach(){
            if(document.getElementById("reach").checked || document.getElementById("double").checked){
                document.getElementById("ippatsu").disabled = false;
            } else {
                document.getElementById("ippatsu").disabled = true;
                document.getElementById("ippatsu").checked = false;
            }
            if(document.getElementById("double").checked){
                document.getElementById("reach").disabled = true;
                document.getElementById("reach").checked = false;
                if(document.getElementById("ippatsu").checked){
                    document.getElementById("haitei").disabled = true;
                    document.getElementById("haitei").checked = false;
                } else {
                    document.getElementById("haitei").disabled = false;
                }
            } else {
                document.getElementById("reach").disabled = false;
                document.getElementById("haitei").disabled = false;
            }
            if(document.getElementById("ippatsu").checked || document.getElementById("haitei").checked){
                document.getElementById("rinshang").disabled = true;
                document.getElementById("rinshang").checked = false;
                document.getElementById("chankan").disabled = true;
                document.getElementById("chankan").checked = false;
            } else {
                document.getElementById("chankan").disabled = false;
                if(document.getElementById("chankan").checked){
                    document.getElementById("tsumo").disabled = true;
                    document.getElementById("ron").checked = true;
                    document.getElementById("rinshang").disabled = true;
                    document.getElementById("rinshang").checked = false;
                } else {
                    document.getElementById("tsumo").disabled = false;
                    document.getElementById("rinshang").disabled = false;
                }
            }
        } //function checkReach()
        hai = [];
        function calc(){
            bakaze = document.getElementById("wind1").value;
            jikaze = document.getElementById("wind2").value;
            for(i=1; i<=5; i++){
                hai[i-1] = [];
                hai[i-1][0] = type = document.getElementById("type" + i).value;
                hai[i-1][6] = document.getElementById("div" + i).value;
                if(i == 5){
                    console.log(hai);
                    agari = document.getElementById("div6").value;
                    if(type == "c" || hai[i-1][6] / 10 < agari){
                        if(type != "c" && (hai[i-1][6] - 2) % 11 == 0 && hai[i-1][6] != "2"){
                            agari = parseInt(agari);
                            hai[i-1][6] = String(agari * 111 - 99);
                        } else{
                            hai[i-1][6] += agari;
                        }
                    } else {
                        hai[i-1][6] = agari + hai[i-1][6];
                    }
                }
                hai[i-1][1] = len = hai[i-1][6].length;
                if(len == "2" && (type == "c" || hai[i-1][6] % 11 == 0)){
                    if(hai[i-1][6].substr(0, 1) != hai[i-1][6].substr(1, 1)){
                        hai[i-1][2] = "-1";
                        hai[i-1][3] = "?";
                    } else {
                        hai[i-1][2] = 0;
                        hai[i-1][3] = "対子";
                        document.getElementById("call" + i).checked = false;
                    }
                } else if(len == 4 && (type == "c" || hai[i-1][6] % 1111 == 0)){
                    if(hai[i-1][6].substr(0, 1) != hai[i-1][6].substr(1, 1) || hai[i-1][6].substr(0, 1) != hai[i-1][6].substr(2, 1) || hai[i-1][6].substr(0, 1) != hai[i-1][6].substr(3, 1)){
                        hai[i-1][2] = "-1";
                        hai[i-1][3] = "?";
                    } else {
                        hai[i-1][2] = 3;
                        hai[i-1][3] = "槓子";
                    }
                } else if(len == 3 && (type == "c" || hai[i-1][6] % 111 == 0)){
                    if(hai[i-1][6].substr(0, 1) != hai[i-1][6].substr(1, 1) || hai[i-1][6].substr(0, 1) != hai[i-1][6].substr(2, 1)){
                        hai[i-1][2] = "-1";
                        hai[i-1][3] = "?";
                    } else {
                        hai[i-1][2] = 2;
                        hai[i-1][3] = "刻子";
                    }
                } else if(len == 3 && hai[i-1][6] % 111 == 12){
                    hai[i-1][2] = 1;
                    hai[i-1][3] = "順子";
                } else {
                    hai[i-1][2] = "-1";
                    hai[i-1][3] = "?";
                }
                hai[i-1][7] = hai[i-1][6].substr(0, 1);
                if(hai[i-1][2] == 1){
                    hai[i-1][8] = hai[i-1][6].substr(1, 1);
                    hai[i-1][9] = hai[i-1][6].substr(2, 1);
                }
                switch(hai[i-1][7]){
                    case "e":
                        hai[i-1][7] = "東";
                        break;
                    case "s":
                        hai[i-1][7] = "南";
                        break;
                    case "w":
                        hai[i-1][7] = "西";
                        break;
                    case "n":
                        hai[i-1][7] = "北";
                        break;
                    case "b":
                        hai[i-1][7] = "白";
                        break;
                    case "f":
                        hai[i-1][7] = "発";
                        break;
                    case "z":
                        hai[i-1][7] = "中";
                        break;
                    default:
                        break;
                }
                hai[i-1][4] = (document.getElementById("call" + i).checked) ? 0 : 1;
                if(hai[i-1][2] == 1){
                    hai[i-1][5] = 0;
                } else if(hai[i-1][2] == 0){
                    hai[i-1][5] = ["白", "発", "中"].includes(hai[i-1][7]);
                    hai[i-1][5] += (hai[i-1][7] == bakaze);
                    hai[i-1][5] += (hai[i-1][7] == jikaze);
                    hai[i-1][5] *= 2;
                } else if(hai[i-1][2] >= 2){
                    hai[i-1][5] = 4;
                    hai[i-1][5] /= (hai[i-1][4] == 0) ? 2 : 1;
                    hai[i-1][5] *= (hai[i-1][2] == 3) ? 4 : 1;
                    hai[i-1][5] *= (type == "c" || hai[i-1][7] == 1 || hai[i-1][7] == 9) ? 2 : 1;
                    hai[i-1][5] /= (i == 5 && document.getElementById("mj").tsumoron.value == "ron") ? 2: 1;
                } else {
                    hai[i-1][5] = "?";
                }
                document.getElementById("ci" + i).innerHTML = hai[i-1][3];
                document.getElementById("fu" + i).innerHTML = hai[i-1][5];
            }
            changeFu();
            checkYaku();
        }
        function changeFu(){
            tr = document.getElementById("mj").tsumoron.value;
            if(tr == "tsumo"){
                fu6 = 2;
            } else if(tr == "ron"){
                flag = 1;
                for(i=1; i<=5; i++){
                    flag *= hai[i-1][4];
                }
                fu6 = (flag == 1) ? 10 : 0;
            }
            document.getElementById("fu6").innerHTML = fu6;
            if(hai[4][2] == 2 || (hai[4][0] != "c" && (document.getElementById("div5").value % 11 == 1 && (document.getElementById("div5").value != "12" && document.getElementById("div5").value != "89")))){
                fu7 = document.getElementById("fu7").innerHTML = 0;
            } else {
                fu7 = document.getElementById("fu7").innerHTML = 2;
            }
            fusum = 20 + fu6 + fu7;
            for(i=1; i<=5; i++){
                fusum += hai[i-1][5];
            }
            document.getElementById("fu8").innerHTML = (Number.isInteger(fusum)) ? (fusum + "→" + Math.ceil(Math.max(fusum, 22) / 10) * 10) : "?";
        }
        yaku_list = {
            //'役':["門前", "食い下がり"]
            '四暗刻':["役満", "-"],
            '四槓子':["役満", "役満"],
            '字一色':["役満", "役満"],
            '大三元':["役満", "役満"],
            '大四喜':["役満", "役満"],
            '小四喜':["役満", "役満"],
            '清老頭':["役満", "役満"],
            '緑一色':["役満", "役満"],
            '立直':[1, "-"],
            'ダブル立直':[2, "-"],
            '一発':[1, "-"],
            '門前清自摸和':[1, "-"],
            '海底摸月':[1, 1],
            '河底撈魚':[1, 1],
            '嶺上開花':[1, 1],
            '槍槓':[1, 1],
            '役牌':[1, 1],
            '平和':[1, 1],
            '一盃口':[1, "-"],
            '二盃口':[3, "-"],
            '三色同順':[2, 1],
            '三色同刻':[2, 2],
            '清一色':[6, 5],
            '混一色':[3, 2],
            '混老頭':[2, 2],
            '断么九':[1, 1],
            '純全帯么九':[3, 2],
            '混全帯么九':[2, 1],
            '対々和':[2, 2],
            '三暗刻':[2, 2],
            '三槓子':[2, 2],
            '小三元':[2, 2],
            '一気通貫':[2, 1]
            }
        str_yaku = "<tr style='background: #DDD'><td>翻数</td><td>通常</td><td>鳴き</td><td>翻数</td><td>通常</td><td>鳴き</td></tr>";
        flag = 0;
        for( var key in yaku_list) {
            if( yaku_list.hasOwnProperty(key) ) {
                if(flag == 0){
                    str_yaku += "<tr><td>" + key + "</td><td>" + yaku_list[key][0] + "</td><td>" + yaku_list[key][1] + "</td>";
                    flag += 1;
                } else {
                    str_yaku += "<td>" + key + "</td><td>" + yaku_list[key][0] + "</td><td>" + yaku_list[key][1] + "</td></tr>";
                    flag = 0;
                }

            }
        }
        document.getElementById("yaku_list").innerHTML = str_yaku;
        han_list = [
            /*1*/"満貫", /*2*/"満貫", /*3*/"満貫", /*4*/"満貫", /*5*/"満貫",
            /*6*/"跳満", /*7*/"跳満",
            /*8*/"倍満", /*9*/"倍満", /*10*/"倍満",
            /*11*/"三倍満", /*12*/"三倍満",
            /*13*/"役満"];

        function checkYaku(){
            if(document.getElementById("aotenjou").checked) {
                han_tensuu = {
                    "満貫":10000000,
                    "跳満":10000000,
                    "倍満":10000000,
                    "三倍満":10000000,
                    "役満":10000000
                }
            } else {
                han_tensuu = {
                    "満貫":8000,
                    "跳満":12000,
                    "倍満":16000,
                    "三倍満":24000,
                    "役満":32000
                }
            }
            flag = 0;
            for(i=1; i<=5; i++){
                flag += 0 ** hai[i-1][2];
            }
            yaku = "";
            if(flag == 1){
                naki = 1;
                for(i=1; i<=5; i++){
                    naki *= hai[i-1][4];
                }
                naki = -naki + 1;
                flag_yakuman = 0;

                // 四暗刻
                flag = 0;
                for(i=1; i<=4; i++){
                    (hai[i-1][2] >= 2 && hai[i-1][4] == 1) ? flag += 1 : flag = flag;
                }
                if(hai[4][2] == 2 && document.getElementById("mj").tsumoron.value == "tsumo"){flag += 1;}
                if(flag == 4){
                    yaku += "<tr><td>四暗刻</td><td>" + yaku_list["四暗刻"][naki] + "</td></tr>\n";
                    flag_yakuman += 1;
                }

                // 四槓子
                flag = 0;
                for(i=1; i<=4; i++){
                    (hai[i-1][2] == 3) ? flag += 1: flag = flag;
                }
                if(flag == 4){
                    yaku += "<tr><td>四槓子</td><td>" + yaku_list["四槓子"][naki] + "</td></tr>\n";
                    flag_yakuman += 1;
                }

                //字一色
                flag = 0
                for(i=1; i<=5; i++){
                    (hai[i-1][0] == "c") ? flag += 1 : flag = flag;
                }
                if(flag == 5){
                    yaku += "<tr><td>字一色</td><td>" + yaku_list["字一色"][naki] + "</td></tr>\n";
                    flag_yakuman += 1;
                }

                //大三元
                flag = 0;
                for(i=1; i<=5; i++){
                    (hai[i-1][0] == "c" && hai[i-1][2] >= 2) ? flag += ["白", "発", "中"].includes(hai[i-1][7]) : flag = flag;
                }
                if(flag == 3){
                    yaku += "<tr><td>大三元</td><td>" + yaku_list["大三元"][naki] + "</td></tr>\n";
                    flag_yakuman += 1;
                }

                //大四喜・小四喜
                flag = 0;
                for(i=1; i<=5; i++){
                    (hai[i-1][0] == "c" && hai[i-1][2] >= 2) ? flag += ["東", "南", "西", "北"].includes(hai[i-1][7]) : flag = flag;
                    (hai[i-1][0] == "c" && hai[i-1][2] == 0) ? flag += ["東", "南", "西", "北"].includes(hai[i-1][7]) / 2 : flag = flag;
                }
                if(flag == 4){
                    yaku += "<tr><td>大四喜</td><td>" + yaku_list["大四喜"][naki] + "</td></tr>\n";
                    flag_yakuman += 1;
                } else if(flag == 3.5){
                    yaku += "<tr><td>小四喜</td><td>" + yaku_list["小四喜"][naki] + "</td></tr>\n";
                    flag_yakuman += 1;
                }

                //清老頭
                flag = 0;
                for(i=1; i<=5; i++){
                    (hai[i-1][2] != 1 && (hai[i-1][7] == 1 || hai[i-1][7] == 9)) ? flag += 1 : flag = flag;
                }
                if(flag == 5){
                    yaku += "<tr><td>清老頭</td><td>" + yaku_list["清老頭"][naki] + "</td></tr>\n";
                    flag_yakuman += 1;
                }

                //緑一色
                flag = 0;
                for(i=1; i<=5; i++){
                    if(hai[i-1][2] == 1){
                        (hai[i-1][0] == "s" && hai[i-1][6] == 234) ? flag += 1 : flag = flag;
                    } else {
                        (hai[i-1][0] == "s" && (hai[i-1][7] % 2 == 0 || hai[i-1][7] == 3) || hai[i-1][7] == "発") ? flag += 1 : flag = flag;
                    }
                }
                if(flag == 5){
                    yaku += "<tr><td>緑一色</td><td>" + yaku_list["緑一色"][naki] + "</td></tr>\n";
                    flag_yakuman += 1;
                }

            if(flag_yakuman == 0){
                han_sum = 0;
                //立直・ダブル立直
                if(naki == 1){document.getElementById("reach").checked = false;document.getElementById("double").checked = false;document.getElementById("ippatsu").checked = false;}
                if(document.getElementById("double").checked){
                    yaku += "<tr><td>ダブル立直</td><td>" + yaku_list["ダブル立直"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["ダブル立直"][naki];
                } else if(document.getElementById("reach").checked){
                    yaku += "<tr><td>立直</td><td>" + yaku_list["立直"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["立直"][naki];
                }

                //一発
                if(document.getElementById("ippatsu").checked){
                    yaku += "<tr><td>一発</td><td>" + yaku_list["一発"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["一発"][naki];
                }

                //門前清自摸和
                if(naki == 0 && document.getElementById("mj").tsumoron.value == "tsumo"){
                    yaku += "<tr><td>門前清自摸和</td><td>" + yaku_list["門前清自摸和"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["門前清自摸和"][naki];
                }

                //海底摸月・河底撈魚
                if(document.getElementById("haitei").checked){
                    if(document.getElementById("mj").tsumoron.value == "tsumo"){
                        yaku += "<tr><td>海底摸月</td><td>" + yaku_list["海底摸月"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["海底摸月"][naki];
                    } else {
                        yaku += "<tr><td>河底撈魚</td><td>" + yaku_list["河底撈魚"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["河底撈魚"][naki];
                    }
                }

                //嶺上開花
                if(document.getElementById("rinshang").checked){
                    flag = 0;
                    for(i=1; i<=4; i++){
                        (hai[i-1][2] == 3) ? flag += 1: flag = flag;
                    }
                    if(flag == 0){
                        document.getElementById("rinshang").checked = false;
                    } else {
                        yaku += "<tr><td>嶺上開花</td><td>" + yaku_list["嶺上開花"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["嶺上開花"][naki];
                    }
                }

                //槍槓
                if(document.getElementById("chankan").checked){
                    yaku += "<tr><td>槍槓</td><td>" + yaku_list["槍槓"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["槍槓"][naki];
                }

                //役牌
                for(i=1; i<=5; i++){
                    if(hai[i-1][2] >= 2 && ["白", "発", "中"].includes(hai[i-1][7])){
                        yaku += "<tr><td>" + hai[i-1][7] + "</td><td>" + yaku_list["役牌"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["役牌"][naki];
                    }
                    if(hai[i-1][2] >= 2 && bakaze == hai[i-1][7]){
                        yaku += "<tr><td>" + hai[i-1][7] + "(場風)</td><td>" + yaku_list["役牌"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["役牌"][naki];
                    }
                    if(hai[i-1][2] >= 2 && jikaze == hai[i-1][7]){
                        yaku += "<tr><td>" + hai[i-1][7] + "(自風)</td><td>" + yaku_list["役牌"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["役牌"][naki];
                    }
                }

                //平和
                if(naki == 0 && document.getElementById("fu7").innerHTML == 0){
                    flag = 0;
                    for(i=1; i<=5; i++){
                        flag += hai[i-1][5];
                    }
                    if(flag == 0){
                        yaku += "<tr><td>平和</td><td>" + yaku_list["平和"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["平和"][naki];
                        if(document.getElementById("mj").tsumoron.value == "tsumo"){
                            document.getElementById("fu6").innerHTML = 0;
                            document.getElementById("fu8").innerHTML = "20→20";
                            fusum = 20;
                        }
                    }
                }

                //一盃口・二盃口
                if(naki == 0){
                    flag = [];
                    flag_jyun = 0;
                    for(i=0; i<21; i++){
                        flag[i] = 0;
                    }
                    for(i=1; i<=5; i++){
                        if(hai[i-1][2] == 1){
                            index = (hai[i-1][6] - 12) / 111 - 1;
                            index += (hai[i-1][0] == "p") ? 7: 0;
                            index += (hai[i-1][0] == "s") ? 14: 0;
                            flag[index] += 1;
                            flag_jyun += 1;
                        }
                    }
                    if(Math.max.apply(null, flag) >= 2){
                        if(flag.includes(1) || flag_jyun <= 3){
                            yaku += "<tr><td>一盃口</td><td>" + yaku_list["一盃口"][naki] + "翻</td></tr>\n";
                            han_sum +=  yaku_list["一盃口"][naki];
                        } else if(flag_jyun == 4){
                            yaku += "<tr><td>二盃口</td><td>" + yaku_list["二盃口"][naki] + "翻</td></tr>\n";
                            han_sum +=  yaku_list["二盃口"][naki];
                        }
                    }
                }

                //三色同順
                flag = [];
                for(i=1; i<=7; i++){
                    flag[i-1] = 0;
                    for(j=1; j<=5; j++){
                        if(hai[j-1][2] == 1){
                            (hai[j-1][0] == "m" && hai[j-1][6] == i * 111 + 12) ? flag[i-1] += 1 : 0;
                            (hai[j-1][0] == "p" && hai[j-1][6] == i * 111 + 12) ? flag[i-1] += 5 : 0;
                            (hai[j-1][0] == "s" && hai[j-1][6] == i * 111 + 12) ? flag[i-1] += 25 : 0;
                        }
                    }
                }
                if([31, 32, 36, 56].includes(Math.max.apply(null, flag))){
                    yaku += "<tr><td>三色同順</td><td>" + yaku_list["三色同順"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["三色同順"][naki];
                }

                //三色同刻
                flag = [];
                for(i=1; i<=9; i++){
                    flag[i-1] = 0;
                    for(j=1; j<=5; j++){
                        if(hai[j-1][2] >= 2){
                            (hai[j-1][0] == "m" && hai[j-1][7] == i) ? flag[i-1] += 1 : 0;
                            (hai[j-1][0] == "p" && hai[j-1][7] == i) ? flag[i-1] += 5 : 0;
                            (hai[j-1][0] == "s" && hai[j-1][7] == i) ? flag[i-1] += 25 : 0;
                        }
                    }
                }
                if([31, 32, 36, 56].includes(Math.max.apply(null, flag))){
                    yaku += "<tr><td>三色同刻</td><td>" + yaku_list["三色同刻"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["三色同刻"][naki];
                }

                //清一色
                flag = 0;
                flag_iro = hai[0][0];
                for(i=2; i<=5; i++){
                    (flag_iro == hai[i-1][0]) ? flag += 1 : flag = flag;
                }
                if(flag == 4){
                    yaku += "<tr><td>清一色</td><td>" + yaku_list["清一色"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["清一色"][naki];
                }

                //混一色
                if(flag != 4){
                    flag = 0;
                    flag_iro = "";
                    for(i=1; i<=5; i++){
                        if(hai[i-1][0] != "c" && flag == 0){
                            flag_iro = hai[i-1][0];
                            flag += 1;
                        } else if(hai[i-1][0] != "c" && flag_iro != hai[i-1][0]){
                            flag += 1;
                        }
                    }
                    if(flag == 1){
                        yaku += "<tr><td>混一色</td><td>" + yaku_list["混一色"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["混一色"][naki];
                    }
                }

                //断么九・混全帯么九・純全帯么九・混老頭
                flag = 0;
                for(i=1; i<=5; i++){
                    (hai[i-1][2] != 1 && (hai[i-1][7] == 1 || hai[i-1][7] == 9)) ? flag += 1 : flag = flag;
                    (hai[i-1][0] == "c") ? flag += 1 : flag = flag;
                }
                if(flag == 5){
                    yaku += "<tr><td>混老頭</td><td>" + yaku_list["混老頭"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["混老頭"][naki];
                } else {
                    flag = 0;
                    for(i=1; i<=5; i++){
                        if(hai[i-1][0] == "c" || (hai[i-1][2] == 1 && hai[i-1][6] % 666 == 123) || (hai[i-1][2] != 1 && hai[i-1][7] % 8 == 1)){
                            if(hai[i-1][0] != "c"){
                                flag += 1.1;
                            } else {
                                flag += 1;
                            }
                        }
                    }
                    if(flag == 0){
                        yaku += "<tr><td>断么九</td><td>" + yaku_list["断么九"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["断么九"][naki];
                    } else if(flag == 5.5){
                        yaku += "<tr><td>純全帯么九</td><td>" + yaku_list["純全帯么九"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["純全帯么九"][naki];
                    } else if(flag >= 5){
                        yaku += "<tr><td>混全帯么九</td><td>" + yaku_list["混全帯么九"][naki] + "翻</td></tr>\n";
                        han_sum +=  yaku_list["混全帯么九"][naki];
                    }
                }

                // 対々和
                flag = 0;
                for(i=1; i<=5; i++){
                    (hai[i-1][2] >= 2) ? flag += 1 : flag = flag;
                }
                if(flag == 4){
                    yaku += "<tr><td>対々和</td><td>" + yaku_list["対々和"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["対々和"][naki];
                }
                // 三暗刻
                flag = 0;
                for(i=1; i<=4; i++){
                    (hai[i-1][2] >= 2 && hai[i-1][4] == 1) ? flag += 1 : flag = flag;
                }
                if(hai[4][2] == 2 && document.getElementById("mj").tsumoron.value == "tsumo"){flag += 1;}
                if(flag == 3){
                    yaku += "<tr><td>三暗刻</td><td>" + yaku_list["三暗刻"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["三暗刻"][naki];
                }

                // 三槓子
                flag = 0;
                for(i=1; i<=4; i++){
                    (hai[i-1][2] == 3) ? flag += 1: flag = flag;
                }
                if(flag == 3){
                    yaku += "<tr><td>三槓子</td><td>" + yaku_list["三槓子"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["三槓子"][naki];
                }

                //小三元
                flag = 0;
                for(i=1; i<=5; i++){
                    (hai[i-1][0] == "c" && hai[i-1][2] >= 2) ? flag += ["白", "発", "中"].includes(hai[i-1][7]) : flag = flag;
                    (hai[i-1][0] == "c" && hai[i-1][2] == 0) ? flag += ["白", "発", "中"].includes(hai[i-1][7]) / 2 : flag = flag;
                }
                if(flag == 2.5){
                    yaku += "<tr><td>小三元</td><td>" + yaku_list["小三元"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["小三元"][naki];
                }

                //一気通貫
                flag = {"m":0, "s":0, "p":0};
                for(i=1; i<=5; i++){
                    if(hai[i-1][2] == 1 && hai[i-1][6] % 333 == 123){
                        flag[hai[i-1][0]] += 5 ** ((hai[i-1][6] - 123) /333);
                    }
                }
                if(flag["m"] == 31 || flag["s"] == 31 || flag["p"] == 31){
                    yaku += "<tr><td>一気通貫</td><td>" + yaku_list["一気通貫"][naki] + "翻</td></tr>\n";
                    han_sum +=  yaku_list["一気通貫"][naki];
                }

                //点数表示
                if(han_sum > 0){
                    if(document.getElementById("dora").value > 0){
                        yaku += "<tr><td>ドラ</td><td>" + document.getElementById("dora").value + "翻</td></tr>\n";
                        han_sum += parseInt(document.getElementById("dora").value);
                    }
                    yaku += "<tr style='background: #FFB'><td>合計</td><td>" + han_sum + "翻</td></tr>\n";
                    if(Number.isInteger(fusum)){
                        tensuu_sum = Math.ceil(Math.max(fusum, 22) / 10) * 10 * 2 ** han_sum * 4;
                        if(tensuu_sum >= han_tensuu["満貫"] / 4){
                            document.getElementById("tokuten1").innerHTML = "<td>翻数</td>";
                            document.getElementById("hansuu").innerHTML = han_sum;
                            document.getElementById("fusuu").innerHTML = "-";
                            document.getElementById("tokuten2").innerHTML = "→";
                            if(jikaze == "東"){
                                document.getElementById("tensuu").innerHTML = han_list[Math.min(Math.round(han_sum-1), 12)] + ' ('+ han_tensuu[han_list[Math.min(Math.round(han_sum-1), 12)]] * 1.5 + '点)';
                            } else {
                                document.getElementById("tensuu").innerHTML = han_list[Math.min(Math.round(han_sum-1), 12)] + ' ('+ han_tensuu[han_list[Math.min(Math.round(han_sum-1), 12)]] + '点)';
                            }
                                // str = "<tr><td>" + han_sum + "</td><td>" + Math.ceil(Math.max(fusum, 22) / 10) * 10 + "</td><td>→</td><td>" + han_list[Math.min(han_sum-1, 12)] + "</td><td style='background: #FFB'>";
                            str = "";
                            if(document.getElementById("mj").tsumoron.value == "tsumo"){
                                if(jikaze == "東"){
                                    str += han_tensuu[han_list[Math.min(han_sum-1, 12)]] / 2 + "オール(子)</td></tr>";
                                } else {
                                    str += han_tensuu[han_list[Math.min(han_sum-1, 12)]] / 4 + "(子)<br>" + han_tensuu[han_list[Math.min(han_sum-1, 12)]] / 2 + "(親)</td></tr>";
                                }
                            } else {
                                if(jikaze == "東"){
                                    // str += han_tensuu[han_list[Math.min(han_sum-1, 12)]] * 1.5 + "</td></tr>";
                                } else {
                                    // str += han_tensuu[han_list[Math.min(han_sum-1, 12)]] + "</td></tr>";
                                }
                            }
                            document.getElementById("tokuten3").innerHTML = str;
                        } else {
                            document.getElementById("tokuten1").innerHTML = "2<sup>（翻数）</sup>";
                            document.getElementById("hansuu").innerHTML = Math.round(2 ** han_sum * 100) / 100;
                            document.getElementById("fusuu").innerHTML = Math.ceil(Math.max(fusum, 22) / 10) * 10;
                            str = "";
                            if(document.getElementById("mj").tsumoron.value == "tsumo"){
                                if(jikaze == "東"){
                                    document.getElementById("tokuten2").innerHTML = "× 4 × 6 =";
                                    document.getElementById("tensuu").innerHTML = Math.round(tensuu_sum * 6 * 10) / 10 + "→" + Math.ceil(tensuu_sum * 6 / 100) * 100;
                                    str += Math.ceil(tensuu_sum / 50) * 100 + "オール(子)</td></tr>";
                                } else {
                                    document.getElementById("tokuten2").innerHTML = "× 4 × 4 =";
                                    document.getElementById("tensuu").innerHTML = Math.round(tensuu_sum * 4 * 10) / 10 + "→" + Math.ceil(tensuu_sum * 4 / 100) * 100;
                                    str += Math.ceil(tensuu_sum / 100) * 100 + "(子)<br>" + Math.ceil(tensuu_sum / 50) * 100 + "(親)</td></tr>";
                                }
                            } else {
                                if(jikaze == "東"){
                                    document.getElementById("tokuten2").innerHTML = "× 4 × 6 =";
                                    document.getElementById("tensuu").innerHTML = Math.round(tensuu_sum * 6 * 10) / 10 + "→" + Math.ceil(tensuu_sum * 6 / 100) * 100;
                                    // str += " × 6</td><td>=</td><td style='background: #FFB'>" + tensuu_sum * 6+ "→" + Math.ceil(tensuu_sum * 6 / 100) * 100 + "</td></tr>";
                                } else {
                                    document.getElementById("tokuten2").innerHTML = "× 4 × 4 =";
                                    document.getElementById("tensuu").innerHTML = Math.round(tensuu_sum * 4 * 10) / 10 + "→" + Math.ceil(tensuu_sum * 4 / 100) * 100;
                                    // str += " × 4</td><td>=</td><td style='background: #FFB'>" + tensuu_sum * 4 + "→" + Math.ceil(tensuu_sum / 25) * 100 + "</td></tr>";
                                }
                            }
                            document.getElementById("tokuten3").innerHTML = str;
                        }
                    } else {
                        document.getElementById("fusuu").innerHTML = 0;
                    }
                } else {
                    yaku += '<tr><td colspan="2">役がありません</td></tr>';
                    document.getElementById("hansuu").innerHTML = " ";
                    document.getElementById("fusuu").innerHTML = " ";
                    document.getElementById("tensuu").innerHTML = " ";
                }
            } else {
                document.getElementById("tokuten1").innerHTML = " ";
                document.getElementById("tokuten2").innerHTML = " ";
                document.getElementById("tensuu").innerHTML = '役満 (' + han_tensuu["役満"] + '点)';
            }
            } else {
                yaku += '<tr><td colspan="2">入力が間違っています</td></tr>';
                document.getElementById("tokuten1").innerHTML = " ";
                document.getElementById("tokuten2").innerHTML = " ";
                document.getElementById("tokuten3").innerHTML = " ";
                document.getElementById("tensuu").innerHTML = " ";
            }
            yaku = '<table id="yaku" style="float:left"><tr><td>役名</td><td>翻数</td></tr>' + yaku + "</table>";
            document.getElementById("yaku").innerHTML = yaku;
        }
    </script>
</body>
</html>